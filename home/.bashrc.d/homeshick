if [ -d "$HOME/.homesick/repos/homeshick" ] && [ -x "/usr/bin/git" ]; then
  source "$HOME/.homesick/repos/homeshick/homeshick.sh"
  source "$HOME/.homesick/repos/homeshick/completions/homeshick-completion.bash"

  # Determine time since last dotfiles pull
  if [ $(uname) == "Linux" ] && [ -f $HOME/.homesick/repos/dotfiles/.git/FETCH_HEAD ]; then
    DOTFILESLAG=$(expr $(date +%s) - $(date +%s -r $HOME/.homesick/repos/dotfiles/.git/FETCH_HEAD))
  elif [ $(uname) == "Darwin" ] && [ -f $HOME/.homesick/repos/dotfiles/.git/FETCH_HEAD ]; then
    DOTFILESLAG=$(echo $(( $(date +%s) - $(stat -f%c $HOME/.homesick/repos/dotfiles/.git/FETCH_HEAD) )))
  else
    echo "Unable to verify dotfiles pull"
    DOTFILESLAG = 0
  fi
  echo "Dotfiles were updated $DOTFILESLAG seconds ago"

  # Update dotfiles if necessary
  if [ $(ssh-add -l | wc -l) -ge 1 ] && [ $DOTFILESLAG -gt 86400 ]; then
    echo "Updating dotfiles..."
    homeshick -q pull
  else
    homeshick -q -f -b refresh
  fi
fi
